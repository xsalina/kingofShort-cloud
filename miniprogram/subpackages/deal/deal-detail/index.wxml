<view class="container">
  <view class="page-header" wx:if="{{stockName}}">
    <view class="header-left">
      <text class="stock-name">{{stockName}}</text>
      <text class="stock-code" wx:if="{{stockCode}}">{{stockCode}}</text>
    </view>
  </view>
  <view class="card status-card">
    <view class="row-between">
      <view>
        <view class="stock-title">{{detailInfo.stockName}}</view>
        <view class="text-sub">{{detailInfo.code}}</view>
      </view>
      <view class="badge badge-{{detailInfo.status}} font-lg">{{detailText}}</view>
    </view>
  </view>
  <block wx:if="{{detailInfo.status != 'sold'}}">
    <view class="section-title">æ•°å€¼è¶‹åŠ¿</view>
    <view class="card market-card">
      <view class="market-grid">
        <view class="market-item">
          <text class="label">åŠ¨æ€å‚è€ƒå€¼</text>
          <view class="value-group">
            <text class="font-xl font-bold">{{detailInfo.currency}}{{currentPrice || '--'}}</text>
          </view>
        </view>
        <view class="market-item text-right">
          <text class="label">é¢„è®¡å·®å€¼ (æµ®åŠ¨)</text>
          <view class="font-xl font-bold {{futureEstimatedProfit >= 0 ? 'text-warn' : 'text-primary'}}">
            {{futureEstimatedProfit >= 0 ? '+' : '-'}}{{detailInfo.currency}}{{futureEstimatedProfitText || '0.00'}}
          </view>
        </view>
        <view class="divider"></view>
        <view class="market-item">
          <view class="label">åŸºå‡†æ•°å€¼ (å•è‚¡)</view>
          <view class="value">{{detailInfo.currency}}{{detailInfo.avgCost}}</view>
        </view>
        <view class="market-item text-right">
          <view class="label">å‰©ä½™æ•°é‡</view>
          <view class="value">
            {{detailInfo.remainingQuantity}}
            <text class="font-sm">è‚¡</text>
          </view>
        </view>
      </view>
    </view>
  </block>
  <view class="section-title">ä¹°å…¥ä¿¡æ¯</view>
  <view class="card info-card">
    <view class="info-grid">
      <view class="info-item">
        <text class="label">ä¹°å…¥ä»·æ ¼</text>
        <text class="value">{{detailInfo.currency}}{{detailInfo.price}}</text>
      </view>
      <view class="info-item">
        <text class="label">ä¹°å…¥æ•°é‡</text>
        <text class="value">{{detailInfo.quantity}}</text>
      </view>
      <view class="info-item">
        <text class="label">ä¹°å…¥æ‰‹ç»­è´¹</text>
        <text class="value">{{detailInfo.currency}}{{detailInfo.fee}}</text>
      </view>
      <view class="info-item">
        <text class="label">æ€»æˆæœ¬</text>
        <text class="value font-bold">{{detailInfo.currency}}{{buyTotalMoney}}</text>
      </view>
      <view class="info-item full-width">
        <text class="label">ä¹°å…¥æ—¶é—´</text>
        <text class="value">{{detailInfo.buyTimeText}}</text>
      </view>
    </view>
  </view>
  <block wx:if="{{detailInfo.status != 'unSold' && detailInfo.sellRecords.length}}">
    <view class="section-title">å–å‡º/æ”¶ç›Šè®°å½• (æœ€è¿‘ä¸€æ¬¡)</view>
    <view class="card info-card sell-theme">
      <view class="info-grid">
        <view class="info-item">
          <text class="label">å–å‡ºä»·æ ¼</text>
          <text class="value">{{detailInfo.sellRecords[0].sellPrice}}</text>
        </view>
        <view class="info-item">
          <text class="label">å–å‡ºæ•°é‡</text>
          <text class="value">{{detailInfo.sellRecords[0].sellQuantity}}</text>
        </view>
        <view class="info-item">
          <text class="label">å–å‡ºæ‰‹ç»­è´¹</text>
          <text class="value">
            {{detailInfo.currency}}{{detailInfo.sellRecords[0].sellFee || 0}}
          </text>
        </view>
        <view class="info-item">
          <text class="label">å–å‡ºæ—¶é—´</text>
          <text class="value font-sm">{{detailInfo.sellRecords[0].sellTimeText}}</text>
        </view>
        <view class="info-item full-width">
          <text class="label">ç´¯è®¡å®ç°æ”¶ç›Š</text>
          <view class="value font-xl {{detailInfo.totalProfit>=0?'text-primary':'text-warn'}}">
            {{detailInfo.totalProfit >=0 ? '+' : ''}}{{detailInfo.currency}}{{detailInfo.totalProfitText}}
          </view>
        </view>
      </view>
    </view>
  </block>
  
  <view class="footer-action" wx:if="{{detailInfo.status === 'unSold' || detailInfo.status === 'partial'}}">
    <view class="strategy-tool" bindtap="goToStrategy">
      <view class="tool-icon-bg">
        <text class="icon">ğŸ§®</text>
      </view>
      <text class="label">ç­–ç•¥æ¨æ¼”</text>
    </view>
    <view class="btn-sell" bindtap="openSell">
      <text>ç§»é™¤æ“ä½œ</text>
    </view>
  </view>
</view>
<sell-modal show="{{showSellModal}}" tx="{{detailInfo}}" bind:close="handleCancel" bind:confirm="handleSell" />
<coin-effect show="{{showCoinEffect}}" amount="{{profitAmount}}" bind:finish="onEffectFinish" />